#!/bin/bash

set -eo pipefail

if [ $# -gt 0 ]; then
    case $1 in
        --clean)
            sudo rm -rf ${HOME}/.local/src/GNOME/
            sudo rm -rf ${HOME}/.local/src/World/
            export CLEAN=1
            ;;
        *)
            echo "Unrecognized argument $1"
            exit 1
            ;;
    esac
fi

[ -z "$GBUILD_MESON_ARGS" ] && export GBUILD_MESON_ARGS="--prefix=/usr"

t1=$(date +%s%N)

# GNOME Core
gbuild GNOME/gtk
gbuild GNOME/gtk-doc
# gbuild GNOME/libgdata
gbuild GNOME/GLib
gbuild GNOME/glib-networking
gbuild GNOME/gi-docgen
gbuild GNOME/json-glib
# gbuild GNOME/vala
gbuild GNOME/libdex
gbuild GNOME/libmks
gbuild GNOME/libsoup
gbuild jwestman/blueprint-compiler
gbuild GNOME/dconf
gbuild GNOME/gdk-pixbuf
gbuild GNOME/gnome-desktop
gbuild GNOME/gvdb
gbuild GNOME/gsettings-desktop-schemas
# gbuild GNOME/xdg-user-dirs-gtk
# gbuild GNOME/libxml2
gbuild GNOME/gvfs
gbuild GNOME/gcr
gbuild GNOME/gobject-introspection
gbuild GNOME/pygobject
gbuild GNOME/pango
gbuild GNOME/librsvg
gbuild GNOME/libhandy
gbuild GNOME/libshumate
gbuild GNOME/libgweather
gbuild GNOME/tinysparql
gbuild GNOME/libsoup
gbuild GNOME/vte
gbuild GNOME/glycin
gbuild GNOME/gjs
gbuild GNOME/libpanel
gbuild GNOME/libadwaita
gbuild GNOME/adwaita-icon-theme
gbuild GNOME/gnome-keyring
gbuild GNOME/gnome-session
gbuild GNOME/mutter
gbuild GNOME/gnome-shell
gbuild GNOME/gdm
gbuild GNOME/xdg-desktop-portal-gnome

gbuild GNOME/sushi
gbuild GNOME/loupe
gbuild GNOME/evince
gbuild GNOME/polari
gbuild GNOME/connections
gbuild GNOME/gnome-settings-daemon
gbuild GNOME/gnome-shell-extensions
gbuild GNOME/gnome-control-center
gbuild GNOME/gnome-online-accounts
gbuild GNOME/gnome-remote-desktop
gbuild GNOME/gnome-disk-utility
gbuild GNOME/gnome-text-editor
gbuild GNOME/gnome-tweaks
gbuild GNOME/gnome-software
gbuild GNOME/gnome-calendar
gbuild GNOME/gnome-calculator
gbuild GNOME/gnome-usage
gbuild GNOME/gnome-boxes
gbuild GNOME/gnome-music
gbuild GNOME/gnome-weather
gbuild GNOME/gnome-maps

gbuild GNOME/localsearch
gbuild GNOME/nautilus

# non-core packages
gbuild World/fragments
gbuild World/chatty
gbuild TheEvilSkeleton/refine
gbuild chergert/ptyxis
# gbuild World/fractal

t2=$(date +%s%N)
delta=$(echo "scale=4;($t2-$t1)/1000000000.0" | bc)
echo -e "$(date) -- Built all in ${delta}s\n" | sudo tee -a /var/log/gbuild.log
